<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CodeNest Admin Dashboard</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    :root{
      --brand:#2b5cff; --bg:#f5f7fb; --card:#fff; --line:#e6e9f2; --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Pretendard,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:#111}
    header{display:flex;align-items:center;gap:12px;background:var(--brand);color:#fff;padding:14px 20px;font-weight:700}
    header .right{margin-left:auto}
    header .right button{background:rgba(255,255,255,.18);border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}

    .wrap{display:flex;min-height:calc(100vh - 56px)}
    aside{width:240px;background:#fff;border-right:1px solid var(--line);padding:16px}
    .logo{display:flex;align-items:center;gap:8px;margin-bottom:10px}
    .logo img{width:28px;height:28px}
    nav a{display:block;padding:10px 12px;border-radius:8px;color:#333;text-decoration:none;margin:2px 0}
    nav a.active, nav a:hover{background:#eff3ff;color:var(--brand);font-weight:600}

    main{flex:1;display:grid;grid-template-columns: 1fr 420px;gap:16px;padding:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px}
    .card h2{margin:0 0 8px}
    .hint{font-size:12px;color:var(--muted);margin-bottom:12px}
    label{display:block;font-weight:600;margin-top:12px}
    input,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{padding:9px 12px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn.ghost{background:#fff;color:#111}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .kv{display:grid;grid-template-columns:130px 1fr auto auto;gap:8px;align-items:center}
    .muted{color:var(--muted);font-size:12px}

    /* ë¡œê·¸ì¸ */
    #login{max-width:360px;margin:64px auto;background:#fff;border:1px solid var(--line);border-radius:12px;padding:20px}
    #login h2{margin-top:0}
    #error{color:#c0392b;font-size:12px;margin-top:6px}

    /* ë¯¸ë¦¬ë³´ê¸° */
    .preview{position:sticky;top:16px;height:fit-content}
    .pv-hero{border:1px dashed var(--line);border-radius:12px;padding:16px;background:#fafbff}
    .pv-hero h3{margin:0 0 6px}
    .pv-chip{display:inline-block;background:#eef2ff;border:1px solid #dbe1ff;margin:2px 4px 0 0;padding:4px 8px;border-radius:999px;font-size:12px}
    .pv-cta{display:inline-block;margin-top:8px;padding:8px 12px;border-radius:10px;background:var(--brand);color:#fff;text-decoration:none}
    .pv-sub{color:var(--muted);margin:6px 0 0}
    .pv-aw{font-size:12px;color:#374151;margin-top:4px}
  </style>
</head>
<body>
  <header>
    <img src="/assets/img/logo/logo3.png" alt="" width="26" height="26" style="border-radius:6px">
    CodeNest ê´€ë¦¬ì
    <div class="right"><button id="logoutBtn" style="display:none">ë¡œê·¸ì•„ì›ƒ</button></div>
  </header>

  <!-- ë¡œê·¸ì¸ -->
  <section id="login" style="display:none">
    <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
    <label>ì´ë©”ì¼</label>
    <input id="email" type="email" placeholder="admin@codenest.com">
    <label>ë¹„ë°€ë²ˆí˜¸</label>
    <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
    <div class="row">
      <button class="btn primary" id="loginBtn">ë¡œê·¸ì¸</button>
    </div>
    <div id="error"></div>
    <p class="muted" style="margin-top:8px">* Firebase Authentication(ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸)ì„ í™œì„±í™”í•˜ê³ , ê´€ë¦¬ì ê³„ì •ì„ ì½˜ì†”ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</p>
  </section>

  <!-- ëŒ€ì‹œë³´ë“œ -->
  <div class="wrap" id="app" style="display:none">
    <aside>
      <div class="logo">
        <img src="/assets/img/logo/logo3.png" alt="CodeNest">
        <strong>Dashboard</strong>
      </div>
      <nav>
        <a href="#" data-tab="tab-hero" class="active">Hero ê´€ë¦¬</a>
        <a href="#" data-tab="tab-about">About ê´€ë¦¬</a>
        <a href="#" data-tab="tab-faq">FAQ ê´€ë¦¬</a>
      </nav>
    </aside>

    <main>
      <!-- LEFT: forms -->
      <div class="left">
        <!-- HERO -->
        <div class="card" id="tab-hero">
          <h2>Hero ê´€ë¦¬</h2>
          <div class="hint">ê° í•­ëª© ì˜† <b>ì €ì¥/ë˜ëŒë¦¬ê¸°</b> ë²„íŠ¼ìœ¼ë¡œ ê°œë³„ ê´€ë¦¬ë©ë‹ˆë‹¤.</div>

          <label>í—¤ë“œë¼ì¸ (highlight)</label>
          <div class="row">
            <input id="hero_headline" type="text" placeholder="ì‘ì€ ê¸°ì—…ë„ í° ì‹ ë¢°ë¥¼" oninput="renderPreview()">
            <button class="btn primary" onclick="saveHeroField('headline')">ì €ì¥</button>
            <button class="btn" onclick="undoHeroField('headline')">ë˜ëŒë¦¬ê¸°</button>
          </div>

          <label>Animated Words (ì‰¼í‘œ êµ¬ë¶„ Â· 4ê°œ ê¶Œì¥)</label>
          <div class="row">
            <input id="hero_aw" type="text" placeholder="ëœë”©í˜ì´ì§€, ê¸°ì—…í˜• í™ˆí˜ì´ì§€, ìì‚¬ëª°, ì„œë¹„ìŠ¤ í”Œë«í¼" oninput="renderPreview()">
            <button class="btn primary" onclick="saveHeroField('animatedWords')">ì €ì¥</button>
            <button class="btn" onclick="undoHeroField('animatedWords')">ë˜ëŒë¦¬ê¸°</button>
          </div>

          <label>ì„œë¸Œ í…ìŠ¤íŠ¸</label>
          <div class="row" style="align-items:flex-start">
            <textarea id="hero_sub" placeholder="í•©ë¦¬í•œ ë¹„ìš©ìœ¼ë¡œ, ë‹¹ì‹ ì˜ ë¸Œëœë“œë¥¼ ì˜¨ë¼ì¸ì—ì„œ ë¹›ë‚˜ê²Œ í•©ë‹ˆë‹¤." oninput="renderPreview()"></textarea>
            <div class="row" style="flex-direction:column;gap:6px">
              <button class="btn primary" onclick="saveHeroField('sub')">ì €ì¥</button>
              <button class="btn" onclick="undoHeroField('sub')">ë˜ëŒë¦¬ê¸°</button>
            </div>
          </div>

          <div class="kv" style="grid-template-columns:130px 1fr auto auto;">
            <label>CTA í…ìŠ¤íŠ¸</label>
            <input id="hero_ctaText" type="text" placeholder="ë¬¸ì˜í•˜ê¸°" oninput="renderPreview()">
            <button class="btn primary" onclick="saveHeroField('ctaText')">ì €ì¥</button>
            <button class="btn" onclick="undoHeroField('ctaText')">ë˜ëŒë¦¬ê¸°</button>

            <span class="muted">ë²„íŠ¼ URL</span>
            <input id="hero_ctaUrl" type="text" placeholder="#contact" oninput="renderPreview()">
            <button class="btn primary" onclick="saveHeroField('ctaUrl')">ì €ì¥</button>
            <button class="btn" onclick="undoHeroField('ctaUrl')">ë˜ëŒë¦¬ê¸°</button>
          </div>

          <div class="row" style="margin-top:12px">
            <button class="btn" id="loadHero">ë¶ˆëŸ¬ì˜¤ê¸°</button>
          </div>
          <p class="muted">ì €ì¥ ì‹œ <code>siteContent/hero</code>ì˜ í•´ë‹¹ í•„ë“œë§Œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. í¼ë¸”ë¦­ í˜ì´ì§€ í˜¸í™˜ í‚¤(<code>banners/mainHero</code>, <code>siteTexts/main</code>)ë„ í•„ìš”í•œ í•­ëª©ë§Œ ë™ê¸°í™”í•©ë‹ˆë‹¤.</p>
        </div>

        <!-- ABOUT -->
        <div class="card" id="tab-about" style="display:none">
          <h2>About ê´€ë¦¬</h2>
          <div class="hint">íšŒì‚¬ì†Œê°œ ì„¹ì…˜ í•­ëª©ë³„ ì €ì¥/ë˜ëŒë¦¬ê¸°</div>

          <label>Eyebrow</label>
          <div class="row">
            <input id="about_eyebrow" type="text" placeholder="About CodeNest">
            <button class="btn primary" onclick="saveAboutField('eyebrow')">ì €ì¥</button>
            <button class="btn" onclick="undoAboutField('eyebrow')">ë˜ëŒë¦¬ê¸°</button>
          </div>

          <label>Typing íƒ€ì´í‹€ (ì‰¼í‘œ êµ¬ë¶„)</label>
          <div class="row">
            <input id="about_titles" type="text" placeholder="ì „í™˜ì„ ë§Œë“œëŠ” ì›¹, ë¹„ì¦ˆë‹ˆìŠ¤ ì„±ì¥ì„ ë•ëŠ” UX, ë¹ ë¥´ê²Œ, ì œëŒ€ë¡œ, ì•ˆì •ì ìœ¼ë¡œ">
            <button class="btn primary" onclick="saveAboutField('title')">ì €ì¥</button>
            <button class="btn" onclick="undoAboutField('title')">ë˜ëŒë¦¬ê¸°</button>
          </div>

          <label>ì„œë¸Œ ë¬¸êµ¬(HTML í—ˆìš©)</label>
          <div class="row" style="align-items:flex-start">
            <textarea id="about_sub" placeholder="ìš°ë¦¬ëŠ” <b>ì‘ì§€ë§Œ ë¹ ë¥¸ íŒ€</b>ì…ë‹ˆë‹¤..."></textarea>
            <div class="row" style="flex-direction:column;gap:6px">
              <button class="btn primary" onclick="saveAboutField('sub')">ì €ì¥</button>
              <button class="btn" onclick="undoAboutField('sub')">ë˜ëŒë¦¬ê¸°</button>
            </div>
          </div>

          <div class="kv">
            <span class="muted">ì§€í‘œ Â· ì™„ë£Œ í”„ë¡œì íŠ¸</span>
            <input id="about_stat_projects" type="number" placeholder="127">
            <button class="btn primary" onclick="saveAboutField('stat_projects')">ì €ì¥</button>
            <button class="btn" onclick="undoAboutField('stat_projects')">ë˜ëŒë¦¬ê¸°</button>

            <span class="muted">ì§€í‘œ Â· ë°˜ë³µ ê³ ê°</span>
            <input id="about_stat_clients" type="number" placeholder="32">
            <button class="btn primary" onclick="saveAboutField('stat_clients')">ì €ì¥</button>
            <button class="btn" onclick="undoAboutField('stat_clients')">ë˜ëŒë¦¬ê¸°</button>

            <span class="muted">ì§€í‘œ Â· ë§Œì¡±ë„(%)</span>
            <input id="about_stat_satisfaction" type="number" placeholder="98">
            <button class="btn primary" onclick="saveAboutField('stat_satisfaction')">ì €ì¥</button>
            <button class="btn" onclick="undoAboutField('stat_satisfaction')">ë˜ëŒë¦¬ê¸°</button>
          </div>

          <div class="row" style="margin-top:12px">
            <button class="btn" id="loadAbout">ë¶ˆëŸ¬ì˜¤ê¸°</button>
          </div>
          <p class="muted">ì €ì¥ ì‹œ <code>siteContent/about</code>ì˜ í•´ë‹¹ í•„ë“œë§Œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
        </div>

        <!-- FAQ -->
        <div class="card" id="tab-faq" style="display:none">
          <h2>FAQ ê´€ë¦¬</h2>
          <div class="hint">Q/Aë¥¼ ì¶”ê°€í•˜ë©´ ê³µê°œ ì‚¬ì´íŠ¸ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>

          <label>ì§ˆë¬¸</label>
          <input id="faq_q" type="text" placeholder="CodeNestëŠ” ì–´ë–¤ íšŒì‚¬ì¸ê°€ìš”?">
          <label>ë‹µë³€</label>
          <textarea id="faq_a" placeholder="í™ˆí˜ì´ì§€ ì œì‘ ì „ë¬¸ ìŠ¤íƒ€íŠ¸ì—…ì…ë‹ˆë‹¤."></textarea>

          <div class="row">
            <button class="btn primary" id="addFaq">FAQ ì¶”ê°€</button>
          </div>
          <p class="muted">ì €ì¥ ìœ„ì¹˜: <code>faq</code> ì»¬ë ‰ì…˜</p>
        </div>
      </div>

      <!-- RIGHT: live preview -->
      <div class="preview">
        <div class="card">
          <h2 style="margin-bottom:10px">ë¼ì´ë¸Œ ë¯¸ë¦¬ë³´ê¸°</h2>
          <div class="pv-hero">
            <h3 id="pv_headline">ì‘ì€ ê¸°ì—…ë„ í° ì‹ ë¢°ë¥¼</h3>
            <div class="pv-aw" id="pv_aw">ëœë”©í˜ì´ì§€ Â· ê¸°ì—…í˜• í™ˆí˜ì´ì§€ Â· ìì‚¬ëª° Â· ì„œë¹„ìŠ¤ í”Œë«í¼</div>
            <div class="pv-sub" id="pv_sub">í•©ë¦¬í•œ ë¹„ìš©ìœ¼ë¡œ, ë‹¹ì‹ ì˜ ë¸Œëœë“œë¥¼ ì˜¨ë¼ì¸ì—ì„œ ë¹›ë‚˜ê²Œ í•©ë‹ˆë‹¤.</div>
            <a href="#contact" class="pv-cta" id="pv_cta">ë¬¸ì˜í•˜ê¸°</a>
            <div class="muted" style="margin-top:10px">* ê³µê°œ í˜ì´ì§€ì™€ ìŠ¤íƒ€ì¼ì€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë©°, ë‚´ìš© ë°˜ì˜ ìœ„ì¹˜ í™•ì¸ìš©ì…ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, addDoc, collection, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ğŸ” í”„ë¡œì íŠ¸ ì„¤ì • (ë‹¹ì‹ ì˜ í”„ë¡œì íŠ¸ ê°’)
    const firebaseConfig = {
      apiKey: "AIzaSyD5YRRr6AEWZcVPKSKXHOSquYHt1rFw_jU",
      authDomain: "codenest-7d987.firebaseapp.com",
      projectId: "codenest-7d987",
      storageBucket: "codenest-7d987.firebasestorage.app",
      messagingSenderId: "504218965101",
      appId: "1:504218965101:web:245f9e8ff8652e3e46db64"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== Undo ìŠ¤íƒ (í•„ë“œë³„) =====
    // key ì˜ˆ: 'hero.headline', 'about.sub'
    const undoStack = {};

    function pushUndo(key, oldValue){
      if(!undoStack[key]) undoStack[key] = [];
      undoStack[key].push(oldValue);
    }
    function popUndo(key){
      if(!undoStack[key] || undoStack[key].length===0) return undefined;
      return undoStack[key].pop();
    }

    // ===== íƒ­/ë¯¸ë¦¬ë³´ê¸° =====
    document.querySelectorAll('nav a').forEach(a=>{
      a.addEventListener('click',e=>{
        e.preventDefault();
        document.querySelectorAll('nav a').forEach(x=>x.classList.remove('active'));
        a.classList.add('active');
        const id = a.getAttribute('data-tab');
        document.querySelectorAll('.left .card').forEach(c=>c.style.display='none');
        document.getElementById(id).style.display='block';
      });
    });
    window.renderPreview = function(){
      const hl = document.getElementById('hero_headline').value || 'ì‘ì€ ê¸°ì—…ë„ í° ì‹ ë¢°ë¥¼';
      const aw = (document.getElementById('hero_aw').value || 'ëœë”©í˜ì´ì§€, ê¸°ì—…í˜• í™ˆí˜ì´ì§€, ìì‚¬ëª°, ì„œë¹„ìŠ¤ í”Œë«í¼')
        .split(',').map(s=>s.trim()).filter(Boolean).join(' Â· ');
      const sub = document.getElementById('hero_sub').value || 'í•©ë¦¬í•œ ë¹„ìš©ìœ¼ë¡œ, ë‹¹ì‹ ì˜ ë¸Œëœë“œë¥¼ ì˜¨ë¼ì¸ì—ì„œ ë¹›ë‚˜ê²Œ í•©ë‹ˆë‹¤.';
      const ct = document.getElementById('hero_ctaText').value || 'ë¬¸ì˜í•˜ê¸°';
      document.getElementById('pv_headline').textContent = hl;
      document.getElementById('pv_aw').textContent = aw;
      document.getElementById('pv_sub').textContent = sub;
      document.getElementById('pv_cta').textContent = ct;
    }

    // ===== ì¸ì¦ =====
    const loginSection = document.getElementById('login');
    const appWrap = document.getElementById('app');
    const logoutBtn = document.getElementById('logoutBtn');

    onAuthStateChanged(auth, (user)=>{
      if(user){
        loginSection.style.display='none';
        appWrap.style.display='flex';
        logoutBtn.style.display='inline-block';
        // ì²« ë¡œë“œ
        loadHero(); loadAbout();
      }else{
        loginSection.style.display='block';
        appWrap.style.display='none';
        logoutBtn.style.display='none';
      }
    });
    document.getElementById('loginBtn').addEventListener('click', async ()=>{
      const email = (document.getElementById('email').value||'').trim();
      const pw = document.getElementById('password').value;
      try{ await signInWithEmailAndPassword(auth, email, pw); }
      catch(e){ document.getElementById('error').textContent = 'ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + e.message; }
    });
    logoutBtn.addEventListener('click', ()=>signOut(auth));

    // ===== ê³µí†µ util =====
    const heroDocRef  = () => doc(db,'siteContent','hero');
    const aboutDocRef = () => doc(db,'siteContent','about');

    // í¼ë¸”ë¦­ í˜ì´ì§€ í˜¸í™˜ ì €ì¥(í•„ë“œ ë‹¨ìœ„)
    async function compatSaveHeroField(field, value){
      // banners/mainHero, siteTexts/main í•´ë‹¹ í•„ë“œë§Œ ì—…ë°ì´íŠ¸
      if(field==='headline'){
        await setDoc(doc(db,'banners','mainHero'),{ headline:value },{merge:true});
        await setDoc(doc(db,'siteTexts','main'),{ hero_highlight:value },{merge:true});
      }else if(field==='sub'){
        await setDoc(doc(db,'banners','mainHero'),{ sub:value },{merge:true});
        await setDoc(doc(db,'siteTexts','main'),{ hero_sub:value },{merge:true});
      }else if(field==='ctaText'){
        await setDoc(doc(db,'banners','mainHero'),{ ctaText:value },{merge:true});
        await setDoc(doc(db,'siteTexts','main'),{ hero_cta_primary:value },{merge:true});
      }else if(field==='ctaUrl'){
        await setDoc(doc(db,'banners','mainHero'),{ ctaUrl:value },{merge:true});
        // siteTextsì—ëŠ” URL í‚¤ë¥¼ ì•ˆ ì“°ëŠ” êµ¬ì¡°(í•„ìš”í•˜ë©´ ì¶”ê°€ ê°€ëŠ¥)
      }else if(field==='animatedWords'){
        // 4ê°œê¹Œì§€ë§Œ ë™ê¸°í™”
        const arr = (value||[]).slice(0,4);
        const payloadBanner = {
          aw1:arr[0]||'', aw2:arr[1]||'', aw3:arr[2]||'', aw4:arr[3]||''
        };
        const payloadTexts = {
          hero_aw1:arr[0]||'', hero_aw2:arr[1]||'', hero_aw3:arr[2]||'', hero_aw4:arr[3]||''
        };
        await setDoc(doc(db,'banners','mainHero'), payloadBanner, {merge:true});
        await setDoc(doc(db,'siteTexts','main'), payloadTexts, {merge:true});
      }
    }

    // ===== HERO: load / save per field / undo =====
    async function loadHero(){
      const snap = await getDoc(heroDocRef());
      if(!snap.exists()) return;
      const d = snap.data();
      document.getElementById('hero_headline').value = d.headline||'';
      document.getElementById('hero_aw').value = (d.animatedWords||[]).join(', ');
      document.getElementById('hero_sub').value = d.sub||'';
      document.getElementById('hero_ctaText').value = d.ctaText||'';
      document.getElementById('hero_ctaUrl').value = d.ctaUrl||'';
      renderPreview();
    }
    document.getElementById('loadHero').addEventListener('click', loadHero);

    async function saveHeroField(field){
      try{
        const snap = await getDoc(heroDocRef());
        const before = snap.exists()? snap.data()[field] : undefined;
        // ì…ë ¥ê°’ ì·¨ë“
        let val;
        if(field==='headline')      val = document.getElementById('hero_headline').value;
        else if(field==='animatedWords') val = (document.getElementById('hero_aw').value||'').split(',').map(s=>s.trim()).filter(Boolean);
        else if(field==='sub')      val = document.getElementById('hero_sub').value;
        else if(field==='ctaText')  val = document.getElementById('hero_ctaText').value;
        else if(field==='ctaUrl')   val = document.getElementById('hero_ctaUrl').value;

        // Undo ìŠ¤íƒì— ì´ì „ê°’ push
        pushUndo('hero.'+field, before);

        // í•´ë‹¹ í•„ë“œë§Œ ì—…ë°ì´íŠ¸
        await setDoc(heroDocRef(), { [field]: val }, { merge:true });

        // í¼ë¸”ë¦­ í˜ì´ì§€ í˜¸í™˜ í‚¤ë„ ê°™ì€ í•„ë“œë§Œ ë™ê¸°í™”
        await compatSaveHeroField(field, val);

        alert('ì €ì¥ ì™„ë£Œ');
      }catch(e){
        alert('ì €ì¥ ì‹¤íŒ¨: '+e.message);
        console.error(e);
      }
    }
    window.saveHeroField = saveHeroField;

    async function undoHeroField(field){
      const prev = popUndo('hero.'+field);
      if(prev === undefined){ alert('ë˜ëŒë¦´ ê°’ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
      try{
        // ì…ë ¥ì— ë°˜ì˜
        if(field==='headline')      document.getElementById('hero_headline').value = prev||'';
        else if(field==='animatedWords') document.getElementById('hero_aw').value = (prev||[]).join(', ');
        else if(field==='sub')      document.getElementById('hero_sub').value = prev||'';
        else if(field==='ctaText')  document.getElementById('hero_ctaText').value = prev||'';
        else if(field==='ctaUrl')   document.getElementById('hero_ctaUrl').value = prev||'';

        // Firestore ë˜ëŒë¦¬ê¸°
        await setDoc(heroDocRef(), { [field]: prev }, { merge:true });
        await compatSaveHeroField(field, prev);

        renderPreview();
        alert('ë˜ëŒë ¸ìŠµë‹ˆë‹¤.');
      }catch(e){
        alert('ë˜ëŒë¦¬ê¸° ì‹¤íŒ¨: '+e.message);
        console.error(e);
      }
    }
    window.undoHeroField = undoHeroField;

    // ===== ABOUT: load / save per field / undo =====
    async function loadAbout(){
      const snap = await getDoc(aboutDocRef());
      if(!snap.exists()) return;
      const d = snap.data();
      document.getElementById('about_eyebrow').value = d.eyebrow||'';
      document.getElementById('about_titles').value = (d.title||[]).join(', ');
      document.getElementById('about_sub').value = d.sub||'';
      document.getElementById('about_stat_projects').value = d.stat_projects||'';
      document.getElementById('about_stat_clients').value = d.stat_clients||'';
      document.getElementById('about_stat_satisfaction').value = d.stat_satisfaction||'';
    }
    document.getElementById('loadAbout').addEventListener('click', loadAbout);

    async function saveAboutField(field){
      try{
        const snap = await getDoc(aboutDocRef());
        const before = snap.exists()? snap.data()[field] : undefined;

        let val;
        if(field==='eyebrow') val = document.getElementById('about_eyebrow').value;
        else if(field==='title') val = (document.getElementById('about_titles').value||'').split(',').map(s=>s.trim()).filter(Boolean);
        else if(field==='sub') val = document.getElementById('about_sub').value;
        else if(field==='stat_projects') val = Number(document.getElementById('about_stat_projects').value||0);
        else if(field==='stat_clients') val = Number(document.getElementById('about_stat_clients').value||0);
        else if(field==='stat_satisfaction') val = Number(document.getElementById('about_stat_satisfaction').value||0);

        pushUndo('about.'+field, before);

        await setDoc(aboutDocRef(), { [field]: val }, { merge:true });

        // (ì„ íƒ) í¼ë¸”ë¦­ í˜ì´ì§€ í˜¸í™˜ í‚¤ ì¼ë¶€ ë™ê¸°í™”
        if(field==='eyebrow') await setDoc(doc(db,'siteTexts','main'),{ about_eyebrow: val||'' },{merge:true});
        if(field==='sub') await setDoc(doc(db,'siteTexts','main'),{ about_sub: val||'' },{merge:true});

        alert('ì €ì¥ ì™„ë£Œ');
      }catch(e){
        alert('ì €ì¥ ì‹¤íŒ¨: '+e.message);
        console.error(e);
      }
    }
    window.saveAboutField = saveAboutField;

    async function undoAboutField(field){
      const prev = popUndo('about.'+field);
      if(prev === undefined){ alert('ë˜ëŒë¦´ ê°’ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
      try{
        if(field==='eyebrow') document.getElementById('about_eyebrow').value = prev||'';
        else if(field==='title') document.getElementById('about_titles').value = (prev||[]).join(', ');
        else if(field==='sub') document.getElementById('about_sub').value = prev||'';
        else if(field==='stat_projects') document.getElementById('about_stat_projects').value = prev||0;
        else if(field==='stat_clients') document.getElementById('about_stat_clients').value = prev||0;
        else if(field==='stat_satisfaction') document.getElementById('about_stat_satisfaction').value = prev||0;

        await setDoc(aboutDocRef(), { [field]: prev }, { merge:true });

        if(field==='eyebrow') await setDoc(doc(db,'siteTexts','main'),{ about_eyebrow: prev||'' },{merge:true});
        if(field==='sub') await setDoc(doc(db,'siteTexts','main'),{ about_sub: prev||'' },{merge:true});

        alert('ë˜ëŒë ¸ìŠµë‹ˆë‹¤.');
      }catch(e){
        alert('ë˜ëŒë¦¬ê¸° ì‹¤íŒ¨: '+e.message);
        console.error(e);
      }
    }
    window.undoAboutField = undoAboutField;

    // ===== FAQ: add =====
    document.getElementById('addFaq').addEventListener('click', async ()=>{
      const q = document.getElementById('faq_q').value.trim();
      const a = document.getElementById('faq_a').value.trim();
      if(!q || !a) return alert('ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”');
      try{
        await addDoc(collection(db,'faq'),{question:q, answer:a, createdAt:new Date()});
        document.getElementById('faq_q').value='';
        document.getElementById('faq_a').value='';
        alert('FAQ ì¶”ê°€ ì™„ë£Œ');
      }catch(e){
        alert('ì¶”ê°€ ì‹¤íŒ¨: '+e.message);
        console.error(e);
      }
    });

    // ===== ì´ˆê¸° ë·° ìŠ¤ìœ„ì¹˜(ë³´ì¡°) =====
    const loginView = document.getElementById('login');
    const appView = document.getElementById('app');
    onAuthStateChanged(auth, user=>{
      loginView.style.display = user ? 'none' : 'block';
      appView.style.display   = user ? 'flex' : 'none';
    });
  </script>
</body>
</html>
